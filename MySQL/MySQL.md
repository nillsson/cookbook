# SQL语法规则
- 基础SQL指令一般以行为单位
- SQL指令需要语句结束符，默认是 ; \g \G
    - \G 只要用于查询数据，立体展示结果
- SQL指令类似于自然语言
- 编写SQL中如果用到了关键字或者保留字，用反引号包裹让系统忽略 
- 根据数据库的对象层级，可以将基础SQL操作分为三类
    - 库操作：数据库相关操作
    - 表操作：数据表（字段）相关操作
    - 数据操作：数据相关操作

## 示例
1. 结构创建
    ```
    create 结构类型 结构名 结构描述
    ```
2. 显示结构
    ```
    #显示结构
    show 结构类型（复数） 
    
    #显示创建结构详情
    show create 结构类型 结构名  
    ```
3. 数据操作（数据表）
    ```
    #新增数据
    insert into 表名 values  
    
    #查看数据
    select from 表名 
    
    #更新数据
    update 表名 set 
    
    #删除数据
    delete from 表名 
    ```


## 数据库操作
### 创建数据库
```create database 数据库名字 [数据库选项]```

### 查看数据库
- 显示所有数据库
    ```
    show databases;
    ```
- 显示创建数据库指令
    ```
    show create database 数据库名字
    ```
    
### 使用数据库
    use 数据库名字
    
### 修改数据库
- 数据库名字不可以修改
- 数据库修改指令
    ```
    alter database 数据库名字 库选项 （字符集/校对集）
    ```
- 一般不会使用数据库修改（一般要改也是删除以后再修改）

### 删除数据库
- 建议删前备份
    ```
    drop database 数据库名字
    ```
    
## SQL表（字段）操作
- 创建数据表
    - 表的字段需要指定存储的数据库
        - 明确指定数据库：数据库-表名
        - 先使用数据库：`use 数据库名字`
    - 字段至少需要指定名字、类型
    - 数据库表不限定字段数量
        - 每个字段间使用逗号,分隔
        - 最后一个字段不需要逗号
    - 表创建语法
        ```
        create table [数据库名.]表名（
        字段名 字段类型, 
        ..., 
        字段名 字段类型
        ）
        ```
    - 如果想船舰一个于以又表一样的数据表，MySQL提供了一种便捷的创建方式
        ```
        create table 表名 like 数据库名字.表名
        ```
- 显示数据表
    - 数据表的显示有两种方式
        - 显示所有数据表
            ```
            show tables；
            show tables from 数据库名字；
            ```
        - 显示具体数据表的创建指令
            ```
            show create table 表名； # 看到的结果未必一定是真是创建的指令（系统会加工）
            ```
        - 显示部分关联数据表一一匹配
            ```
            show tables like '%_like'; 
            #_表示匹配一个字符，%表示匹配N个字符
            ```
    - 在显示数据的时候可以使用不同的语句结束符
        - \g 与普通分号无分别
        - \G 纵向显示列数据
- 查看表结构
    ```
    desc 表名；
    describe 表名；
    show columns from 表名；
    ```
- 更改数据表
    - 修改表名
        ```
        rename table 表名 to 新表名；
        ```
    - 修改表选项
        ```
        alter table 表名 [表选项]；
        ```
    - 筒仓我们较少使用更改数据表，数据表应该在创建时就定义好
- 更改字段
    - 字段操作包含字段名字，类型和属性的操作
    - 字段操作分为四类：
        - 新增字段： `add [column]`(默认在所有字段之后)
            ```
            alter table 表名 add [column] 字段名 字段类型 [字段属性] [字段位置];
            ```
            - 字段位置：
                - 第一个字段： first
                - 某个字段后： after 已经存在字段名
                ```
                add table 表名 add 字段名 字段类型 after 字段名；
                ```
        - 更改字段名：`change`
            ```
            alter table 表名 change 原字段名 新字段名 字段类型 [字段属性] [位置]；
            ```
        - 修改类型：`modify`
            - 修改字段类型，字段属性和位置
                ```
                alter table 表名 modify 字段名 字段类型 [字段属性] [位置]；
                ```
        - 删除字段: `drop`
            - 删除字段会将数据同时删除，且不可逆
                ```
                alter table 表名 drop 字段名；
                ```
## SQL数据操作
- 新增数据
    - 全字段插入
        ```
        insert into 表名 values （字段列表顺序对应的所有值），（下一条数据）；
        ```
    - 部分字段插入
        ```
        insert into 表名 (字段列表) values (字段列表顺序对应的所有值)；
        ```
- 查看数据
    - 查到的数据显示出来是一张二维表
    - 数据显示包含字段名和数据本身
    - 两种方式
        - 查看全部字段：使用*代替所有字段
        - 查看部分字段： 明确字段名，使用逗号分隔
    - 查看数据很多时候也是根据条件查询部分数据
        ```
        select * from 表名；
        select 字段名，字段名 from 表名；
        select * from 表名 where 条件；
        ```
- 更新数据
    - 更新数据通常是根据条件更新某些数据，而不是全部记录都更新
    - [批量更新多条数据](https://www.cnblogs.com/mqxs/p/6794725.html)
        ```
        update 表名 set 字段 = 新值， 字段 = 新值 [where 条件]；
        ```
- 删除数据
    - 数据删除通常是有条件删除
        ```
        delete from 表名 [where 条件]；
        ```
 

## 字符集
- 字符集概念
    - ASCII: 美国信息交换标准码，一般英文符号，一个字节存储
    - latin1: 拉丁字符集，一个字节存储，ISO-8859-1的别名，能够向下兼容ASCII
    - GB2312: 信息交换用汉字编码字符集，是中国1981年的一套国际规范，2个字节存储
    - GBK: 汉字内码扩展规范（1995年），2个字节表示
    - Unicode： 万国码（统一码），1994年
    - UTF8: 8-bit Unicode Transformation Foemat，针对Unicode的可变长度字符编码，采用1-16字节编码Unicode字符。建议使用UTF-8字符集进行数据存储。（MySQL中建议使用utf8mb4）
- MySQL字符集关系
    - MySQL内部对象可以在各个层级设置字符集
    - MySQL内部对象存在字符集继承：字段->表->数据库->DBMS
    - MySQL内部内嵌支持几乎所有主流字符集
    - 客户端与服务器进行交互时，需要明确告知服务器客户端使用的字符集
    - 查看MySQL支持的所有字符集
        ```
        show charset；
        ```
    - 服务器端存储的数据最终字符集由字段确定
    - 字段通常不会设置字符集，继承表的字符集（统一性，真正一般都与数据库一致）
- 解决乱码问题
    - 乱码原因
        - 数据在存储的时候已经变成乱码
            - 客户端字符集与服务端解析字符集不一致
            - 读取时想转成其他字符集均会错误
        - 数据存储时正确，但是读取时解析成错误字符集
            - 客户端能解析额字符集与服务器提供的字符集不一致
    - 解决方案：不论存储还是读取，都提前告知服务器当前客户端的字符集（建议在建立连接后第一时间设置）
        ```  
        set names 客户端字符集;
        ```
- 字符集设置原理
    - MySQL服务端提供了变量来记录客户端的字符集
    - MySQL对应的存储字符集的变量可以修改
    - `set names 字符集`就是对变量的修改，总共有三个(只修改这三个)
        - character_set_client: 客户端提供的数据的字符集
        - character_set_results: 客户端需要服务端提供的数据的字符集
        - character_set_connection: 连接使用的字符集，内部数据操作
    - 查看系统内部存储这些记录字符集的信息
        ```
        # %表示通配符，匹配后续所有不确定的数据
        show variables like 'character_set%';
        ```
    - 修改客户端字符集变量，保证数据正常进服务端
        ```
        set character_set_client = gbk;
        ```
    - 修改客户端解析字符集变量，保证数据正常被客户端查看
        ```
        set character_set_results = gbk;
        ```

## 校对集
- 校对集概念（collate/collation）
    - 数据比较时对应的规则
    - 校对方式分为三种
        - 大小写不敏感：_ci, case insensitive
        - 大小写敏感：_cs, case sensitive
        - 二进制比较：_bin, binary(区分大小写)
    - 校对集实在进行数据比较的时候触发
- 校对集设置
    - 校对规则可以在MySQL四层对象设计
        - DBMS：系统配置
        - DB: 数据库指定（库选项）
        - Table: 表指定（表选项）
        - Field： 字段指定（字段选项，一般不用）
    - 校对集从Field到DBMS继承，优先级Field最高
    - 每个校对集都有字符集对应的默认规则
    - 校对集设置语法
        ```
        collate 校对集规则；
        ```
    - 查看MySQL支持的所有校对集
        ```
        show collation;
        ```
    - 在数据库层设计校对集（常见）
        ```
        create database 数据库名 charset 字符集名 collate 校对规则；
        ```
    - 在数据表层设计校对集
        ```
        create table 表名(字段名 属性，) charset 字符集名 collate 校对规则；
        ```
    - 在字段层设计校对集（一般不用）
        ```
        create table 表名（字段名 属性 collate 校对规则） charset 字符集名;
        ```
- 校对集应用
    - 校对集的应用通常是通过数据比较触发： order by 字段
    - 数据表中数据一旦产生，校对集的修改就无效
 
## 字段类型
- 字段类型的作用
    - MySQL中用来规定实际存储的数据格式
    - 字段类型在定义表结构时设定
    - 设定好字段类型后，插入数据时必须与字段类型对应，否则数据错误
    - MySQL共有四大字段类型
- 整数类型
    - 为了数据空间的有效应用，五种整数类型
        - 迷你整型 tinyint: 使用一个字节存储整数，最多存储256个整数（-128-127）
        - 短整型 smallint： 使用2个字节存储整数
        - 中整型mediumint： 使用3个字节存储整数
        - 标准整型int：使用4个字节存储整数
        - 大整型bigint：使用8个字节存储整数
    - 数值型存储在MySQl中分为有符号（有负数）和无符号（纯正数）unsigned
        ```
        create table 表名（字段名 tinyint unsigned）charset utf8mb4;
        ```
- 显示宽度
    - 整数在数据库中显示的符号（数字+符号）个数
    - 显示宽度一般实类型能表示的最大值对应的数字个数（通过desc查看字段显示）
    - 显示宽度包含符号（如果允许为负数，负号会占用一个宽度）
    - 显示宽度可以主动控制，创建字段时加括号确定
    - 显示宽度不影响类型能表示的最大数值
        ```
        alter table list add age tinyint(1) unsigned;
        ```
    - 可以通过zerofill让不够宽度的数值补充道对应宽度，在字段类型后使用zerofill,（默认要求整型为无符号）（通常用于制作规范宽度的数据）
- 小数类型（浮点型）float/double
    - 浮点数又称之为精度数据
        - 单精度float：使用4个字节存储，精度范围为7-8位有效数字
        - 双精度double: 使用8个字节存储，精度范围为15-16位有效数字
    - 读点书超过精度范围会自动进行四舍五入
    - 精度可以指定整数和小数部分
        - 默认不指定，整数部分不超过最大值，小数部分保留2位
        - 可以指定：float/double(总长度，小数部分长度)
    - 可以使用科学记数法插入数据： AEB = A*10^B
        ```
        alter table list add height float(4,1) unsigned;
        update list 
            set height = case age
                when 16 then 177.5
                when 17 then 170.3
                when 18 then 180.2
            end
        where age in (16,17,18);
        ```
- 小数类型（定点型）decimal:能够保证精度的小数
    - 不固定存储空间存储
    - 每9个数字使用4个字节存储
    - 定点型可以指定整数部分长度和小数部分长度 
        - 默认不指定：10位有效证书，0位小数
        - 可以指定： decimal(有效数位，小数部分数位)
        - 有效数位不超过65个
    - 数据规范
        - 整数部分超出报错
        - 小数部分超出四舍五入
        - 小心进位导致整数部分超过指定范围
- 时间日期类型（年）
- 时间日期类型（时间戳）
- 时间日期类型（日期）
- 时间日期类型（日期时间）
- 时间日期类型（时间）
- 字符串类型（定长型）char(L)
    - 定长是指定存储长度
    - 定常的长度是字符而不是字节
        - L的最大值是255
        - 实际存储空间：L字符数*字符集对应字节数
    - 定常里存储的数据不能超过指定长度
    - 字符串数据使用单引号或者双引号包裹
        ```
        alter table list add Mobile char(11);
        ```
- 字符串类型（变长型）varchar(L):根据实际存储的数据变化存储空间
    - 变长型的存储空间是由实际存储数据决定的
    - 变长型的L也是指字符而不是字节
        - L指定的是最大存储的数据长度
        - L最大值理论是655532
        - 变长需要额外产生1-2个字节，用来记录实际数据的长度
            - 数据长度小于256个，多1个字节
            - 数据长度大于256个，多2个字节
        - 实际存储空间：实际字符数*字符集对应字节数+记录长度
        - 变长数据不能超过定义的最大长度
            ```
            ALTER table list ADD School varchar(50);
            ```
- 字符串类型（文本字符串）text/blob:专门用来存储较长的文本
    - 通常在超过255个字符时来使用
    - 本文字符串包含两大类
        - text:普通字符
            - 迷你文本tinytext：不超过2^8-1个字符
            - 普通文本text:不超过2^16-1个字符
            - 中型文本mediumtext：不超过2^24-1个字符
            - 长文本longtext:不超过2^36-1个字符
        - blob：二进制字符（tinyblob,blob,mediumblob,longblob）
    - 文本字符串会自动根据文本长度选择适合的具体类型
    - 一般在文本超过255个字符时，都会使用text（blob现在极少用）
- 字符串类型（枚举）
    - 一种映射存储方式，以较小的空间存储较多的数据
    - 枚举实在定义时确定可能出现的可能
    - 枚举在定义后数据只能出现定义时其中的一种
    - 枚举类似一种单选框
    - 枚举使用1-2个字节存储，最多可以设计65535个选项
    - 枚举实际存储是使用数值，映射对应的元素数据，从1开始
    - 枚举语法：enum(元素1，元素2，...,元素N)
        ```
        ALTER table list MODIFY gender ENUM("M","F");
        UPDATE list SET gender=2 WHERE age=16;
        UPDATE list SET gender="M" WHERE age=17;
        ```
- 字符串类型（集合）set
    - 一种映射存储方式，以较小的空间存储较多的数据
    - 集合实在定义时确定可能出现的可能
    - 集合在顶以后数据只能出现在定义是其中的元素（可以是多个）
    - 集合类似一种多选框
    - 集合使用1-8个字节存储数据，最多可以设计64个元素
    - 结合实际存储是使用数值（二进制位），映射对应的元素数据，每个元素对应一个bit位
    - 集合语法；`set(元素1，元素2，...)`
        ```
        ALTER table list ADD 社团 set('相声','小品','篮球','羽球','足球','游泳','舞蹈','击剑','合唱');
        UPDATE list SET 社团='游泳,击剑' WHERE age=17;
        ```
    - 集合建立的也是映射关系，映射方式是每个元素对应一个字节的比特位，从左边开始第一个对应字节从右边开始的第一位
        ```
        篮球，游泳，合唱 -> 100100100 -> 2^8+2^5+2^2 = 292
        ```